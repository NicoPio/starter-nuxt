# Data Model: Testing Infrastructure

**Feature**: 003-testing-infrastructure
**Date**: 2025-12-04

## Overview

The testing infrastructure feature does not introduce persistent data entities. Test artifacts (screenshots, traces, videos, coverage reports) are ephemeral files generated during test execution and are not part of the application's data model.

## Test Artifacts (Non-Persistent)

While not stored in a database, test execution generates temporary artifacts:

### Test Result
**Purpose**: Represents the outcome of a single test execution
**Storage**: Memory during test run, JSON/HTML reports after completion
**Lifecycle**: Generated → Reported → Archived (optional) → Deleted

**Attributes**:
- `testName`: string - Full test name including describe blocks
- `status`: 'passed' | 'failed' | 'skipped' - Test outcome
- `duration`: number - Execution time in milliseconds
- `error`: Error | null - Error object if failed
- `retries`: number - Number of retry attempts (E2E only)

### Coverage Report
**Purpose**: Represents code coverage metrics for the codebase
**Storage**: JSON file (`coverage/coverage-final.json`), HTML report (`coverage/index.html`)
**Lifecycle**: Generated after test run → Uploaded to CI → Displayed in UI

**Attributes**:
- `lines`: { total: number, covered: number, pct: number }
- `functions`: { total: number, covered: number, pct: number }
- `branches`: { total: number, covered: number, pct: number }
- `statements`: { total: number, covered: number, pct: number }
- `files`: Array<{ path: string, coverage: CoverageMetrics }>

### Test Artifact (E2E)
**Purpose**: Debugging artifacts generated by Playwright
**Storage**: File system (`test-results/`, `playwright-report/`)
**Lifecycle**: Generated on test failure → Stored as CI artifact → Expires after 30 days

**Types**:
- `screenshot`: PNG image captured on failure
- `video`: WebM video of test execution
- `trace`: ZIP file with full browser trace (network, console, DOM snapshots)
- `log`: Text file with console output

## Configuration Entities (Not Persisted)

### Vitest Config
**File**: `vitest.config.ts`
**Purpose**: Defines test runner behavior

**Key Properties**:
- `test.globals`: boolean - Enable global test functions
- `test.environment`: 'node' | 'jsdom' | 'nuxt' - Test environment
- `test.coverage.thresholds`: Coverage requirements
- `test.setupFiles`: Global setup scripts

### Playwright Config
**File**: `playwright.config.ts`
**Purpose**: Defines E2E test behavior

**Key Properties**:
- `use.baseURL`: Test application URL
- `use.screenshot`: Screenshot capture strategy
- `use.trace`: Trace recording strategy
- `projects`: Browser configurations (Chromium, Firefox, Mobile)

## No Database Changes

This feature does **not** require:
- New database tables
- Migrations
- Seed data
- Database indexes
- Foreign key relationships

## File System Structure

Test artifacts are organized in the file system:

```
/Volumes/ExternalMac/Dev/starter-nuxt/
├── coverage/                    # Coverage reports
│   ├── index.html              # HTML coverage report
│   ├── coverage-final.json     # Raw coverage data
│   └── lcov.info               # LCOV format for CI
├── test-results/                # Playwright test results
│   ├── artifacts/              # Screenshots, videos, traces
│   └── results.json            # Test outcomes
├── playwright-report/           # Playwright HTML report
│   └── index.html              # Interactive test report
└── .playwright/                 # Playwright cache
    ├── .auth/                  # Saved authentication states
    └── browsers/               # Cached browser binaries
```

**Cleanup Strategy**:
- Coverage reports: Generated on each run, overwrite previous
- Playwright artifacts: Keep only failed test artifacts, delete after 30 days in CI
- Authentication states: Persist across runs, regenerate if expired

## Test Data Management

### Unit/Component Tests
- **Mock data**: Defined inline in test files (no external fixtures)
- **Factory functions**: Create test data with sensible defaults
- **No database access**: Tests use mocked composables/APIs

### E2E Tests
- **Test database**: Use existing local Supabase instance
- **Seed data**: Create test users via `global-setup.ts`
- **Cleanup**: Reset test data after each test run (optional)
- **Isolation**: Each test worker uses unique test users

**Example Test User**:
```typescript
{
  email: `test-user-${workerIndex}@example.com`,
  password: 'TestPassword123',
  role: 'user', // or 'admin', 'contributor'
  name: 'Test User',
}
```

## State Management in Tests

### Unit Tests
- **Stateless**: Each test is independent
- **Setup/Teardown**: Use `beforeEach`/`afterEach` for clean state

### E2E Tests
- **Shared authentication**: Reuse login state across tests (performance)
- **Isolated data**: Each test creates/cleans its own data
- **Browser context**: Fresh context per test (no shared cookies/localStorage)

## Summary

The testing infrastructure feature is **purely operational** and does not introduce persistent data entities. All test artifacts are ephemeral and stored temporarily in the file system or CI artifacts storage. The focus is on test execution, reporting, and debugging capabilities rather than data persistence.
